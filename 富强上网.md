# 富强上网

## refs

- <https://cloud.tencent.com/developer/article/1348037>

## contents

在 oracle cloud，搭建了 ubuntu / oracle-linux（redhat），选定了能 ping 通的 ip；一键富强脚本都 OK；

## 20230722 更新

07-20：CF 套壳突然失效了，用 ip 直连却没有问题！折腾了一番也不行，在网上论坛逛的时候，说是 freenom 家的域名解析凉了；07-21：换 NameSilo 的域名，然后一顿操作，done！

### 遇到的问题

- oracle-linux 自带的 firewalld 阻止了端口访问；通过 iptables 查看到了 oracle 自带的规则【BareMetalInstanceServices】， 删除 /etc/firewalld/direct.xml 得以清除；firewall-cmd 添加了 443/80/其他端口（添加完一定要 reload）；
- 添加 CF 家的前置；奈何一级域名只有一个，且该域名下有一个 CNAME；只能添加二级域名指向 ip，摸索了几番之后，二级域名单独设定 tls 规则

### 最终成果

1. CF DNS A-rule 添加二级域名，先不点开云朵；
2. Linux 一键富强，包括为二级域名申请证书。（这里的证书实际之后会被 CF 签发的 15 年证书覆盖）；
3. CF 前置
   - cf 签发的证书覆盖服务端 Nginx config pem，只保留证书相关的两条配置，其余注释掉；
   - tls - 自定义 rule，匹配二级域名时候，tls 加密模式【严格】；
   - 开启小云朵 & 清空缓存；

### 访问路径

client【BY 一级域名证书 】-> CF 【By 二级域名证书】-> Linux

### FAQ

- 为啥有两个证书？
  - 一个字：穷！签发的二级证书不能被浏览器等客户端认证，签发能认证的证书需要向 CF 缴费！
- 443 端口注意事项
  - `setsebool httpd_can_network_connect on -P` # 开启端口转发，通过查看 nginx 错误日志找出
  - nginx 配置 ssl_client_certification (与 ssl_verify_client 一起，实现双向 ssl)
